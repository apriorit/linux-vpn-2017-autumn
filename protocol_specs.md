# Спецификация протокола общения между клиентом и сервером

 * Сервер создаёт сокет, слушающий порт, указанный первым аргументом командной строки и ожидает подсоединение. Соединение принимается только от тех устройств, которые прислали серверу "нулевой" пакет: пакет размером 2 байта, первый байт = 0, второй = 1. Это сигнализирует серверу о том, что клиент прислал пакет с запросом на соединение.
 
 * Клиент при присоединении формирует "нулевой" пакет, отправляя несколько раз его серверу (на случай потери пакетов, т.к. используется UDP-протокол).
 
 * После получения "нулевого" пакета, сервер инициализирует DTLS-сессию, происходит рукопожатие, формирование ключей, выбор алгоритмов шифрования. Клиент на данном этапе проверяет аутентичность сервера.
 
 * Сразу после установки DTLS-сесии между клиентом и сервером, сервер формирует из структуры параметров специальный пакет для настройки клиентского туннеля, который включает в себя следущую информацию: размер MTU пакетов, IP-адрес туннеля, битовая маска IP-адреса туннеля, адрес DNS-сервера, IP-адрес маршрутизации и битовую маску адреса маршрутизации (Если адрес указан как 0.0.0.0, значит, что приложение будет пропускать весь исходящий и входащий трафик через себя)
 
 * На сервере и клиенте создаются файловые дескрипторы, которые отвественны за перенаправление трафика из приложений в туннель (тоже является дескриптором) и наоборот.
 
 * Клиент и сервер через определённый промежуток времени посылают "keepalive"-пакеты (первый байт таких пакетов является нулём)
 
 * Если сервер не получает долгое время "keepalive"-пакет, он будет вынужден разорвать соединение и освободить ресурсы, а также завершить данный поток обслуживания клиента.
 
 * Клиент, в свою очередь, при ручном отключении пользователя, отправляет пакет want-disconnect (размером 2 байта, 1 байт = 0, 2 байт = 2) при получении такого пакета сервер сразу закрывает соединение, удаляет туннель и завершает выполнение потока.